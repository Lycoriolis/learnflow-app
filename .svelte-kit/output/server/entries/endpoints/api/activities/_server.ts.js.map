{"version":3,"file":"_server.ts.js","sources":["../../../../../../../src/routes/api/activities/+server.ts"],"sourcesContent":["import type { RequestHandler } from '@sveltejs/kit';\nimport { pool } from '$lib/services/userService.server';\n\nexport const GET: RequestHandler = async ({ url, locals }) => {\n  // Get user ID from the decoded token\n  const userId = locals.user?.uid;\n  \n  if (!userId) {\n    console.error('Unauthorized attempt to access activities API');\n    return new Response(JSON.stringify({ error: 'Unauthorized' }), { status: 401, headers: { 'Content-Type': 'application/json' } });\n  }\n  \n  const limit = parseInt(url.searchParams.get('limit') || '10', 10);\n  \n  try {\n    console.log(`Getting activities for user: ${userId}, limit: ${limit}`);\n    const res = await pool.query(\n      `SELECT id, event_type AS \"eventType\", reference_id AS \"referenceId\", timestamp_start AS \"timestampStart\", timestamp_end AS \"timestampEnd\", metadata\n         FROM activities\n         WHERE user_id = $1\n         ORDER BY timestamp_start DESC\n         LIMIT $2`,\n      [userId, limit]\n    );\n    const activities = res.rows;\n    return new Response(JSON.stringify({ activities }), { headers: { 'Content-Type': 'application/json' } });\n  } catch (err) {\n    console.error('Activities error:', err);\n    return new Response(JSON.stringify({ error: 'Failed to fetch activities' }), { status: 500, headers: { 'Content-Type': 'application/json' } });\n  }\n};"],"names":[],"mappings":";AAGO,MAAM,MAAsB,OAAO,EAAE,KAAK,aAAa;AAEtD,QAAA,SAAS,OAAO,MAAM;AAE5B,MAAI,CAAC,QAAQ;AACX,YAAQ,MAAM,+CAA+C;AAC7D,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAgB,CAAA,GAAG,EAAE,QAAQ,KAAK,SAAS,EAAE,gBAAgB,sBAAsB;AAAA,EAAA;AAG3H,QAAA,QAAQ,SAAS,IAAI,aAAa,IAAI,OAAO,KAAK,MAAM,EAAE;AAE5D,MAAA;AACF,YAAQ,IAAI,gCAAgC,MAAM,YAAY,KAAK,EAAE;AAC/D,UAAA,MAAM,MAAM,KAAK;AAAA,MACrB;AAAA;AAAA;AAAA;AAAA;AAAA,MAKA,CAAC,QAAQ,KAAK;AAAA,IAChB;AACA,UAAM,aAAa,IAAI;AACvB,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,WAAW,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,sBAAsB;AAAA,WAChG,KAAK;AACJ,YAAA,MAAM,qBAAqB,GAAG;AACtC,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,6BAA8B,CAAA,GAAG,EAAE,QAAQ,KAAK,SAAS,EAAE,gBAAgB,sBAAsB;AAAA,EAAA;AAEjJ;"}