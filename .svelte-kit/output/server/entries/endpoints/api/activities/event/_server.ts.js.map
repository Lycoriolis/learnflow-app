{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/activities/event/+server.ts"],"sourcesContent":["import type { RequestHandler } from '@sveltejs/kit';\nimport { pool } from '$lib/services/userService.server';\n\nexport const POST: RequestHandler = async ({ request, locals }) => {\n  const { eventType, referenceId, metadata } = await request.json();\n  const userId = locals.user?.uid;\n  if (!userId) return new Response(null, { status: 401 });\n\n  const prevRes = await pool.query(\n    'SELECT id FROM activities WHERE user_id=$1 ORDER BY timestamp_start DESC LIMIT 1',\n    [userId]\n  );\n  const previousEventId = prevRes.rows[0]?.id || null;\n  const now = Date.now();\n\n  await pool.query(\n    `INSERT INTO activities\n       (user_id, event_type, reference_id, timestamp_start, timestamp_end, metadata, previous_event_id)\n     VALUES ($1,$2,$3,$4,$4,$5,$6)`,\n    [userId, eventType, referenceId, now, metadata, previousEventId]\n  );\n\n  return new Response(null, { status: 201 });\n};"],"names":[],"mappings":";AAGO,MAAM,OAAuB,OAAO,EAAE,SAAS,aAAa;AACjE,QAAM,EAAE,WAAW,aAAa,aAAa,MAAM,QAAQ,KAAK;AAC1D,QAAA,SAAS,OAAO,MAAM;AACxB,MAAA,CAAC,OAAe,QAAA,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK;AAEhD,QAAA,UAAU,MAAM,KAAK;AAAA,IACzB;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AACA,QAAM,kBAAkB,QAAQ,KAAK,CAAC,GAAG,MAAM;AACzC,QAAA,MAAM,KAAK,IAAI;AAErB,QAAM,KAAK;AAAA,IACT;AAAA;AAAA;AAAA,IAGA,CAAC,QAAQ,WAAW,aAAa,KAAK,UAAU,eAAe;AAAA,EACjE;AAEA,SAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK;AAC3C;"}