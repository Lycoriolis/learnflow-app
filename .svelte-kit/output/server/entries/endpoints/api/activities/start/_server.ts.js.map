{"version":3,"file":"_server.ts.js","sources":["../../../../../../../../src/routes/api/activities/start/+server.ts"],"sourcesContent":["import type { RequestHandler } from '@sveltejs/kit';\nimport { pool } from '$lib/services/userService.server';\n\nexport const POST: RequestHandler = async ({ request, locals }) => {\n  const { eventType, referenceId, metadata } = await request.json();\n  const userId = locals.user?.uid;\n  if (!userId) {\n    return new Response(null, { status: 401 });\n  }\n\n  // Link to previous event\n  const prevRes = await pool.query(\n    'SELECT id FROM activities WHERE user_id=$1 ORDER BY timestamp_start DESC LIMIT 1',\n    [userId]\n  );\n  const previousEventId = prevRes.rows[0]?.id || null;\n  const now = Date.now();\n\n  const insertRes = await pool.query(\n    `INSERT INTO activities\n       (user_id, event_type, reference_id, timestamp_start, metadata, previous_event_id)\n     VALUES ($1,$2,$3,$4,$5,$6)\n     RETURNING id`,\n    [userId, eventType, referenceId, now, metadata, previousEventId]\n  );\n\n  const eventId = insertRes.rows[0].id;\n  return new Response(JSON.stringify({ eventId }), { headers: { 'Content-Type': 'application/json' } });\n};"],"names":[],"mappings":";AAGO,MAAM,OAAuB,OAAO,EAAE,SAAS,aAAa;AACjE,QAAM,EAAE,WAAW,aAAa,aAAa,MAAM,QAAQ,KAAK;AAC1D,QAAA,SAAS,OAAO,MAAM;AAC5B,MAAI,CAAC,QAAQ;AACX,WAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK;AAAA,EAAA;AAIrC,QAAA,UAAU,MAAM,KAAK;AAAA,IACzB;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AACA,QAAM,kBAAkB,QAAQ,KAAK,CAAC,GAAG,MAAM;AACzC,QAAA,MAAM,KAAK,IAAI;AAEf,QAAA,YAAY,MAAM,KAAK;AAAA,IAC3B;AAAA;AAAA;AAAA;AAAA,IAIA,CAAC,QAAQ,WAAW,aAAa,KAAK,UAAU,eAAe;AAAA,EACjE;AAEA,QAAM,UAAU,UAAU,KAAK,CAAC,EAAE;AAClC,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,sBAAsB;AACtG;"}