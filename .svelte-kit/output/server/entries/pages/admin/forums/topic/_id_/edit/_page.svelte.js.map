{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../../../src/routes/admin/forums/topic/[id]/edit/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { page } from '$app/stores';\n  import { getForumTopic, updateTopic, getCategories } from '$lib/services/forums/forumService';\n  import type { ForumCategory, ForumTopic } from '$lib/types/forumTypes';\n  import { goto } from '$app/navigation';\n  import Icon from '@iconify/svelte';\n  \n  const topicId = $page.params.id;\n  \n  let title = '';\n  let content = '';\n  let category_id = '';\n  let is_pinned = false;\n  let is_locked = false;\n  let tags: string[] = [];\n  let newTag = '';\n  let categories: ForumCategory[] = [];\n  \n  let isLoading = true;\n  let isSaving = false;\n  let error: string | null = null;\n  let success: string | null = null;\n  \n  onMount(async () => {\n    try {\n      const [topic, categoriesList] = await Promise.all([\n        getForumTopic(topicId),\n        getCategories()\n      ]);\n      \n      if (!topic) {\n        error = 'Topic not found';\n        return;\n      }\n      \n      title = topic.title;\n      content = topic.content || '';\n      category_id = topic.category_id;\n      is_pinned = topic.is_pinned || false;\n      is_locked = topic.is_locked || false;\n      tags = topic.tags || [];\n      categories = categoriesList;\n    } catch (err) {\n      console.error('Error loading topic data:', err);\n      error = 'Failed to load topic data. Please try again.';\n    } finally {\n      isLoading = false;\n    }\n  });\n  \n  function addTag() {\n    if (newTag.trim() && !tags.includes(newTag.trim())) {\n      tags = [...tags, newTag.trim()];\n      newTag = '';\n    }\n  }\n  \n  function removeTag(tag: string) {\n    tags = tags.filter(t => t !== tag);\n  }\n  \n  function handleKeydown(event: KeyboardEvent) {\n    if (event.key === 'Enter') {\n      event.preventDefault();\n      addTag();\n    }\n  }\n  \n  async function handleSubmit() {\n    if (!title.trim() || !content.trim() || !category_id) {\n      error = 'Title, content, and category are required';\n      return;\n    }\n    \n    isSaving = true;\n    error = null;\n    success = null;\n    \n    try {\n      const result = await updateTopic(topicId, {\n        title: title.trim(),\n        content: content.trim(),\n        category_id,\n        is_pinned,\n        is_locked,\n        tags: tags.length > 0 ? tags : undefined\n      });\n      \n      if (result) {\n        success = 'Topic updated successfully!';\n        setTimeout(() => {\n          goto(`/forums/topic/${topicId}`);\n        }, 1500);\n      } else {\n        error = 'Failed to update topic. Please try again.';\n      }\n    } catch (err) {\n      console.error('Error updating topic:', err);\n      error = 'An error occurred while updating the topic.';\n    } finally {\n      isSaving = false;\n    }\n  }\n</script>\n\n<!-- Placeholder for admin topic edit page -->\n\n<div class=\"container mx-auto px-4 py-8\">\n  <div class=\"max-w-3xl mx-auto\">\n    <div class=\"mb-6\">\n      <a href=\"/forums/topic/{topicId}\" class=\"inline-flex items-center text-cherry-600 dark:text-cherry-400 hover:underline mb-4\">\n        <Icon icon=\"mdi:arrow-left\" class=\"w-5 h-5 mr-1\" />\n        Back to Topic\n      </a>\n      \n      <h1 class=\"text-2xl font-bold text-gray-900 dark:text-white\">Edit Forum Topic</h1>\n    </div>\n    \n    {#if isLoading}\n      <div class=\"flex justify-center items-center py-12\">\n        <div class=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cherry-500\"></div>\n      </div>\n    {:else}\n      <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6\">\n        {#if error}\n          <div class=\"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-md mb-6\">\n            <p>{error}</p>\n          </div>\n        {/if}\n        \n        {#if success}\n          <div class=\"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-400 p-4 rounded-md mb-6\">\n            <p>{success}</p>\n          </div>\n        {/if}\n        \n        <div class=\"space-y-6\">\n          <div>\n            <label for=\"title\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Title *\n            </label>\n            <input\n              type=\"text\"\n              id=\"title\"\n              bind:value={title}\n              class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-cherry-500 focus:border-cherry-500 dark:focus:ring-cherry-400 dark:focus:border-cherry-400\"\n              disabled={isSaving}\n            />\n          </div>\n          \n          <div>\n            <label for=\"category\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Category *\n            </label>\n            <select\n              id=\"category\"\n              bind:value={category_id}\n              class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-cherry-500 focus:border-cherry-500 dark:focus:ring-cherry-400 dark:focus:border-cherry-400\"\n              disabled={isSaving}\n            >\n              <option value=\"\" disabled>Select a category</option>\n              {#each categories as category}\n                <option value={category.id}>{category.name}</option>\n              {/each}\n            </select>\n          </div>\n          \n          <div>\n            <label for=\"content\" class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Content *\n            </label>\n            <textarea\n              id=\"content\"\n              bind:value={content}\n              class=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-cherry-500 focus:border-cherry-500 dark:focus:ring-cherry-400 dark:focus:border-cherry-400 min-h-[200px]\"\n              disabled={isSaving}\n            ></textarea>\n            <p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n              You can use Markdown formatting to structure your content.\n            </p>\n          </div>\n          \n          <div>\n            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">\n              Tags\n            </label>\n            <div class=\"flex\">\n              <input\n                type=\"text\"\n                bind:value={newTag}\n                on:keydown={handleKeydown}\n                placeholder=\"Add tags (press Enter to add)\"\n                class=\"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-cherry-500 focus:border-cherry-500 dark:focus:ring-cherry-400 dark:focus:border-cherry-400\"\n                disabled={isSaving}\n              />\n              <button\n                on:click={addTag}\n                type=\"button\"\n                class=\"px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 border-l-0 rounded-r-md hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\"\n                disabled={isSaving || !newTag.trim()}\n              >\n                Add\n              </button>\n            </div>\n            \n            {#if tags.length > 0}\n              <div class=\"flex flex-wrap gap-2 mt-2\">\n                {#each tags as tag}\n                  <div class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300\">\n                    {tag}\n                    <button\n                      on:click={() => removeTag(tag)}\n                      type=\"button\"\n                      class=\"ml-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200\"\n                      disabled={isSaving}\n                    >\n                      <Icon icon=\"mdi:close\" class=\"w-4 h-4\" />\n                    </button>\n                  </div>\n                {/each}\n              </div>\n            {/if}\n          </div>\n          \n          <div class=\"flex space-x-6\">\n            <div class=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                id=\"is_pinned\"\n                bind:checked={is_pinned}\n                class=\"h-4 w-4 text-cherry-600 dark:text-cherry-500 focus:ring-cherry-500 dark:focus:ring-cherry-400 border-gray-300 dark:border-gray-600 rounded\"\n                disabled={isSaving}\n              />\n              <label for=\"is_pinned\" class=\"ml-2 block text-sm text-gray-700 dark:text-gray-300\">\n                Pin this topic\n              </label>\n            </div>\n            \n            <div class=\"flex items-center\">\n              <input\n                type=\"checkbox\"\n                id=\"is_locked\"\n                bind:checked={is_locked}\n                class=\"h-4 w-4 text-cherry-600 dark:text-cherry-500 focus:ring-cherry-500 dark:focus:ring-cherry-400 border-gray-300 dark:border-gray-600 rounded\"\n                disabled={isSaving}\n              />\n              <label for=\"is_locked\" class=\"ml-2 block text-sm text-gray-700 dark:text-gray-300\">\n                Lock this topic (no new replies)\n              </label>\n            </div>\n          </div>\n          \n          <div class=\"flex justify-end space-x-4\">\n            <a \n              href=\"/forums/topic/{topicId}\" \n              class=\"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors\"\n            >\n              Cancel\n            </a>\n            \n            <button \n              on:click={handleSubmit}\n              disabled={isSaving || !title.trim() || !content.trim() || !category_id}\n              class=\"px-4 py-2 bg-cherry-600 text-white rounded-md hover:bg-cherry-700 dark:bg-cherry-500 dark:hover:bg-cherry-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {isSaving ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n        </div>\n      </div>\n    {/if}\n  </div>\n</div>"],"names":["$.store_get"],"mappings":";;;;;;;;;QAQQ,UAAOA,UAAA,iBAAA,CAAA,GAAA,SAAA,IAAA,EAAS,OAAO;0JAuGD,OAAO,CAAA,EAAA,CAAA;;;AAQnB;;;;;;;;"}