{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../src/lib/components/forums/ForumTopic.svelte","../../../../../../../../src/routes/forums/topic/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { currentTopic, posts, loadTopic, isLoading, error } from '$lib/stores/forumStore';\n  import Icon from '@iconify/svelte';\n  import MarkdownRenderer from '$lib/components/shared/MarkdownRenderer.svelte';\n  import type { ForumPost } from '$lib/types/forumTypes';\n  import { createForumPost } from '$lib/services/forums/forumService';\n  import { getAuth } from 'firebase/auth';\n  \n  export let topicId: string;\n  \n  let newPostContent = '';\n  let isSubmitting = false;\n  let submitError: string | null = null;\n  let isAuthenticated = false;\n  \n  onMount(() => {\n    const auth = getAuth();\n    isAuthenticated = !!auth.currentUser;\n    \n    loadTopic(topicId);\n    \n    const unsubscribe = auth.onAuthStateChanged((user) => {\n      isAuthenticated = !!user;\n    });\n    \n    return unsubscribe;\n  });\n  \n  async function handleSubmitPost() {\n    if (!newPostContent.trim() || !isAuthenticated) return;\n    \n    isSubmitting = true;\n    submitError = null;\n    \n    try {\n      const newPost = await createForumPost({\n        topic_id: topicId,\n        content: newPostContent,\n      } as Omit<ForumPost, 'id' | 'created_at'>);\n      \n      if (newPost) {\n        newPostContent = '';\n        // Reload the topic to get the new post\n        await loadTopic(topicId);\n      } else {\n        submitError = 'Failed to create post. Please try again.';\n      }\n    } catch (err) {\n      console.error('Error submitting post:', err);\n      submitError = 'An error occurred while submitting your post.';\n    } finally {\n      isSubmitting = false;\n    }\n  }\n  \n  function formatDate(date: Date | undefined): string {\n    if (!date) return 'Unknown date';\n    \n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    \n    // Less than 24 hours\n    if (diff < 24 * 60 * 60 * 1000) {\n      const hours = Math.floor(diff / (60 * 60 * 1000));\n      \n      if (hours < 1) {\n        const minutes = Math.floor(diff / (60 * 1000));\n        return minutes < 1 ? 'Just now' : `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;\n      }\n      \n      return `${hours} hour${hours !== 1 ? 's' : ''} ago`;\n    }\n    \n    // Less than 7 days\n    if (diff < 7 * 24 * 60 * 60 * 1000) {\n      const days = Math.floor(diff / (24 * 60 * 60 * 1000));\n      return `${days} day${days !== 1 ? 's' : ''} ago`;\n    }\n    \n    // Default to formatted date\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  }\n</script>\n\n<!-- Placeholder for ForumTopic.svelte -->\n\n<div class=\"forum-topic\">\n  {#if $isLoading}\n    <div class=\"flex justify-center items-center py-12\">\n      <div class=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-cherry-500\"></div>\n    </div>\n  {:else if $error}\n    <div class=\"bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-400 p-4 rounded-md mb-6\">\n      <p>{$error}</p>\n    </div>\n  {:else if $currentTopic}\n    <div class=\"mb-6\">\n      <a href=\"/forums/category/{$currentTopic.category_id}\" class=\"inline-flex items-center text-cherry-600 dark:text-cherry-400 hover:underline mb-4\">\n        <Icon icon=\"mdi:arrow-left\" class=\"w-5 h-5 mr-1\" />\n        Back to Forum\n      </a>\n      \n      <h1 class=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">{$currentTopic.title}</h1>\n      \n      <div class=\"flex items-center text-sm text-gray-600 dark:text-gray-400 mb-4\">\n        <span class=\"flex items-center\">\n          <Icon icon=\"mdi:account\" class=\"w-4 h-4 mr-1\" />\n          {$currentTopic.author_name || 'Unknown'}\n        </span>\n        <span class=\"mx-2\">•</span>\n        <span>{formatDate($currentTopic.created_at)}</span>\n        <span class=\"mx-2\">•</span>\n        <span class=\"flex items-center\">\n          <Icon icon=\"mdi:eye-outline\" class=\"w-4 h-4 mr-1\" />\n          {$currentTopic.views} view{$currentTopic.views !== 1 ? 's' : ''}\n        </span>\n        <span class=\"mx-2\">•</span>\n        <span class=\"flex items-center\">\n          <Icon icon=\"mdi:comment-outline\" class=\"w-4 h-4 mr-1\" />\n          {$currentTopic.post_count} repl{$currentTopic.post_count !== 1 ? 'ies' : 'y'}\n        </span>\n      </div>\n      \n      {#if $currentTopic.tags && $currentTopic.tags.length > 0}\n        <div class=\"flex flex-wrap gap-2 mb-4\">\n          {#each $currentTopic.tags as tag}\n            <a href=\"/forums/tag/{tag}\" class=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors\">\n              {tag}\n            </a>\n          {/each}\n        </div>\n      {/if}\n      \n      <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 mb-6\">\n        <div class=\"prose dark:prose-invert max-w-none\">\n          <MarkdownRenderer content={$currentTopic.content} />\n        </div>\n      </div>\n      \n      <h2 class=\"text-xl font-semibold text-gray-900 dark:text-white mb-4\">\n        Replies ({$posts.length})\n      </h2>\n      \n      {#if $posts.length === 0}\n        <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 text-center\">\n          <Icon icon=\"mdi:comment-text-outline\" class=\"w-12 h-12 mx-auto text-gray-400 mb-2\" />\n          <p class=\"text-gray-600 dark:text-gray-400\">No replies yet. Be the first to reply!</p>\n        </div>\n      {:else}\n        <div class=\"space-y-4\">\n          {#each $posts as post}\n            <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden\">\n              <div class=\"p-5\">\n                <div class=\"flex items-start\">\n                  <div class=\"flex-shrink-0 mr-4\">\n                    {#if post.authorAvatar}\n                      <img src={post.authorAvatar} alt={post.author_name} class=\"w-10 h-10 rounded-full\" />\n                    {:else}\n                      <div class=\"w-10 h-10 rounded-full bg-cherry-100 dark:bg-cherry-900/30 flex items-center justify-center\">\n                        <span class=\"text-cherry-600 dark:text-cherry-400 text-lg font-medium\">\n                          {post.author_name?.charAt(0) || 'A'}\n                        </span>\n                      </div>\n                    {/if}\n                  </div>\n                  \n                  <div class=\"flex-1\">\n                    <div class=\"flex items-center justify-between mb-2\">\n                      <span class=\"font-medium text-gray-900 dark:text-white\">{post.author_name || 'Unknown'}</span>\n                      <span class=\"text-sm text-gray-500 dark:text-gray-400\">{formatDate(post.created_at)}</span>\n                    </div>\n                    \n                    <div class=\"prose dark:prose-invert max-w-none\">\n                      <MarkdownRenderer content={post.content} />\n                    </div>\n                    \n                    {#if post.is_answer}\n                      <div class=\"mt-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400\">\n                        <Icon icon=\"mdi:check-circle\" class=\"w-4 h-4 mr-1\" />\n                        Accepted Answer\n                      </div>\n                    {/if}\n                  </div>\n                </div>\n              </div>\n            </div>\n          {/each}\n        </div>\n      {/if}\n      \n      {#if !$currentTopic.is_locked}\n        <div class=\"mt-8\">\n          <h3 class=\"text-lg font-medium text-gray-900 dark:text-white mb-4\">Add Your Reply</h3>\n          \n          {#if isAuthenticated}\n            <div class=\"bg-white dark:bg-gray-800 rounded-lg shadow-md p-5\">\n              <textarea\n                bind:value={newPostContent}\n                placeholder=\"Write your reply here... (Markdown supported)\"\n                class=\"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-cherry-500 focus:border-cherry-500 dark:focus:ring-cherry-400 dark:focus:border-cherry-400 min-h-[150px]\"\n                disabled={isSubmitting}\n              ></textarea>\n              \n              {#if submitError}\n                <div class=\"text-red-600 dark:text-red-400 text-sm mt-2\">{submitError}</div>\n              {/if}\n              \n              <div class=\"flex justify-end mt-4\">\n                <button \n                  on:click={handleSubmitPost}\n                  disabled={isSubmitting || !newPostContent.trim()}\n                  class=\"px-4 py-2 bg-cherry-600 text-white rounded-md hover:bg-cherry-700 dark:bg-cherry-500 dark:hover:bg-cherry-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                >\n                  {isSubmitting ? 'Submitting...' : 'Post Reply'}\n                </button>\n              </div>\n            </div>\n          {:else}\n            <div class=\"bg-gray-100 dark:bg-gray-800 rounded-lg p-5 text-center\">\n              <p class=\"text-gray-700 dark:text-gray-300 mb-3\">You need to be logged in to reply to this topic.</p>\n              <a href=\"/login\" class=\"inline-block px-4 py-2 bg-cherry-600 text-white rounded-md hover:bg-cherry-700 dark:bg-cherry-500 dark:hover:bg-cherry-600 transition-colors\">\n                Log In to Reply\n              </a>\n            </div>\n          {/if}\n        </div>\n      {:else}\n        <div class=\"mt-8 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 text-center text-yellow-800 dark:text-yellow-400\">\n          <Icon icon=\"mdi:lock\" class=\"w-5 h-5 inline-block mr-2\" />\n          This topic is locked. New replies are not allowed.\n        </div>\n      {/if}\n    </div>\n  {:else if !$isLoading}\n    <div class=\"text-center py-12\">\n      <Icon icon=\"mdi:alert-circle-outline\" class=\"w-16 h-16 mx-auto text-gray-400 mb-4\" />\n      <h3 class=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">Topic not found</h3>\n      <p class=\"text-gray-600 dark:text-gray-400\">The topic you're looking for doesn't exist or has been removed.</p>\n      <a href=\"/forums\" class=\"inline-block mt-4 px-4 py-2 bg-cherry-600 text-white rounded-md hover:bg-cherry-700 dark:bg-cherry-500 dark:hover:bg-cherry-600 transition-colors\">\n        Back to Forums\n      </a>\n    </div>\n  {/if}\n</div>","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { page } from '$app/stores';\n  import ForumTopic from '$lib/components/forums/ForumTopic.svelte';\n  \n  const topicId = $page.params.id;\n</script>\n\n<div class=\"container mx-auto px-4 py-8\">\n  <ForumTopic {topicId} />\n</div>\n\n<style>\n  /* Add any component-specific styles here */\n</style>"],"names":["$.escape","$.store_get","$.attr","$.stringify"],"mappings":";;;;;;;;;;MASa,UAAe,QAAA,SAAA;WA+CjB,WAAW,MAAgC;AAC7C,QAAA,CAAA,aAAa;AAEZ,UAAA,0BAAU,KAAI;AACd,UAAA,OAAO,IAAI,QAAO,IAAK,KAAK,QAAO;QAGrC,OAAO,KAAK,KAAK,KAAK,KAAM;YACxB,QAAQ,KAAK,MAAM,QAAQ,KAAK,KAAK,IAAI;UAE3C,QAAQ,GAAG;cACP,UAAU,KAAK,MAAM,QAAQ,KAAK,IAAI;AACrC,eAAA,UAAU,IAAI,aAAgB,GAAA,OAAO,UAAU,YAAY,IAAI,MAAM,EAAE;AAAA,MAChF;AAEU,aAAA,GAAA,KAAK,QAAQ,UAAU,IAAI,MAAM,EAAE;AAAA,IAC/C;QAGI,OAAO,IAAI,KAAK,KAAK,KAAK,KAAM;AAC5B,YAAA,OAAO,KAAK,MAAM,QAAQ,KAAK,KAAK,KAAK,IAAI;AACzC,aAAA,GAAA,IAAI,OAAO,SAAS,IAAI,MAAM,EAAE;AAAA,IAC5C;WAGO,KAAK,mBAAmB,SAAO;AAAA,MACpC,MAAM;AAAA,MACN,OAAO;AAAA,MACP,KAAK;AAAA;EAET;;;;;;;;;;qJAgB6C,WAAW,CAAA,EAAA,CAAA;;8LAK6B,KAAK,CAAA;;AAKnE,cAAA,OAAA,WAAAA,YAAAC,UAAA,iBAAA,IAAA,iBAAA,YAAA,EAAA,eAAe,SAAS,CAGlC,6CAAAD,YAAA,yEAAyB,UAAU,CAAA,CAAA;;;;;AAIzB,cAAA,OAAA,WAAAA,YAAAC,UAAA,iBAAA,CAAA,GAAA,iBAAA,YAAA,EAAA,KAAK,mFAAqB,UAAU,IAAI,MAAM,EAAE,CAAA;;;;;AAKhD,cAAA,OAAA,WAAAD,YAAAC,UAAA,iBAAA,CAAA,GAAA,iBAAA,YAAA,EAAA,UAAU,mFAAqB,eAAe,IAAI,QAAQ,GAAG,CAAA;AAI7D,QAAAA,UAAA,iBAAA,CAAA,GAAA,iBAAA,YAAA,EAAA,QAAsBA,UAAA,iBAAA,CAAA,GAAA,iBAAA,YAAA,EAAA,KAAK,SAAS,GAAC;;yGAE/B,IAAI;;;YAAI,MAAG,WAAA,OAAA;AACR,kBAAA,OAAA,KAAAC,KAAA,QAAA,eAAAC,UAAA,GAAG,6NACtB,GAAG,CAAA;AAAA;;;;;;;6EAQiC;AAAA;sLAK1B,MAAM,CAAA;AAGb,QAAAF,UAAA,iBAAA,CAAA,GAAA,UAAA,KAAA,EAAA,WAAW,GAAC;;;;;;;;;;;;;YAOH,OAAI,aAAA,SAAA;;AAKN,YAAA,KAAK,cAAY;;AACV,oBAAA,OAAA,OAAAC,KAAA,OAAA,KAAK,YAAY,CAAO,GAAAA,KAAA,OAAA,KAAK,WAAW,CAAA;AAAA;;AAI7C,oBAAA,OAAA,mLAAAF,YAAA,KAAK,aAAa,OAAO,CAAC,KAAK,GAAG,CAAA;AAAA;uLAQkB,KAAK,eAAe,SAAS,+EAC9B,WAAW,KAAK,UAAU,CAAA,CAAA;AAIvD,yBAAA,WAAA,EAAA,SAAA,KAAK,QAAO,CAAA;;AAGpC,YAAA,KAAK,WAAS;;;;;;;;;;;;;;;;uEAcb,WAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QC9L3B,UAAOC,UAAA,iBAAA,CAAA,GAAA,SAAA,IAAA,EAAS,OAAO;;;;;;;"}