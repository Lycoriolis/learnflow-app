{"version":3,"file":"_page.server.ts.js","sources":["../../../../../../src/routes/my-learning/+page.server.ts"],"sourcesContent":["import type { PageServerLoad } from './$types';\nimport { getAllContentItemsByType } from '$lib/server/contentService';\nimport { error } from '@sveltejs/kit';\n\nexport const load: PageServerLoad = async ({ parent }) => {\n  // Get parent data and handle case where userProfile might be undefined\n  const parentData = await parent();\n  const userProfile = parentData.userProfile;\n\n  if (!userProfile) {\n    // This case might be handled by the layout guard, but good to be safe\n    return { enrolledCourses: [] }; \n  }\n\n  // Safely access enrollment IDs with proper typings\n  const enrolledIds = userProfile.preferences?.enrollments?.map((e: { id: string }) => e.id) || [];\n\n  if (enrolledIds.length === 0) {\n    return { enrolledCourses: [] };\n  }\n\n  try {\n    // Fetch metadata for all courses\n    const allCourses = await getAllContentItemsByType('courses', 'course');\n    \n    // Filter courses based on enrollment IDs and add enrollment details\n    const enrolledCourses = allCourses\n      .filter(course => enrolledIds.includes(course.id))\n      .map(course => {\n        // Safely access enrollment with null check\n        const enrollment = userProfile.preferences?.enrollments?.find((e: { id: string }) => e.id === course.id);\n        return {\n          meta: course, // Contains id, title, description, path etc.\n          enrollment: enrollment || { progress: 0, lastAccessed: 0 } // Add default if somehow missing\n        };\n      });\n\n    return { enrolledCourses };\n\n  } catch (err) {\n    console.error(\"Error loading enrolled courses in /my-learning:\", err);\n    // Use SvelteKit's error helper for server-side errors\n    throw error(500, 'Failed to load enrolled courses.'); \n  }\n};\n"],"names":[],"mappings":";;AAIO,MAAM,OAAuB,OAAO,EAAE,aAAa;AAElD,QAAA,aAAa,MAAM,OAAO;AAChC,QAAM,cAAc,WAAW;AAE/B,MAAI,CAAC,aAAa;AAET,WAAA,EAAE,iBAAiB,GAAG;AAAA,EAAA;AAIzB,QAAA,cAAc,YAAY,aAAa,aAAa,IAAI,CAAC,MAAsB,EAAE,EAAE,KAAK,CAAC;AAE3F,MAAA,YAAY,WAAW,GAAG;AACrB,WAAA,EAAE,iBAAiB,GAAG;AAAA,EAAA;AAG3B,MAAA;AAEF,UAAM,aAAa,MAAM,yBAAyB,WAAW,QAAQ;AAG/D,UAAA,kBAAkB,WACrB,OAAO,CAAU,WAAA,YAAY,SAAS,OAAO,EAAE,CAAC,EAChD,IAAI,CAAU,WAAA;AAEP,YAAA,aAAa,YAAY,aAAa,aAAa,KAAK,CAAC,MAAsB,EAAE,OAAO,OAAO,EAAE;AAChG,aAAA;AAAA,QACL,MAAM;AAAA;AAAA,QACN,YAAY,cAAc,EAAE,UAAU,GAAG,cAAc,EAAE;AAAA;AAAA,MAC3D;AAAA,IAAA,CACD;AAEH,WAAO,EAAE,gBAAgB;AAAA,WAElB,KAAK;AACJ,YAAA,MAAM,mDAAmD,GAAG;AAE9D,UAAA,MAAM,KAAK,kCAAkC;AAAA,EAAA;AAEvD;"}