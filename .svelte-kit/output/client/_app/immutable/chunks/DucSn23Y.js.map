{"version":3,"file":"DucSn23Y.js","sources":["../../../../../../src/lib/stores/forumStore.ts"],"sourcesContent":["import { persistentStore } from './persistentStore.js';\nimport { writable, derived } from 'svelte/store';\nimport type { ForumCategory, ForumTopic, ForumPost } from '$lib/types/forumTypes';\nimport { \n  getCategories, \n  getTopics, \n  getTopic,\n  getPostsByTopicId\n} from '$lib/services/forums/forumService';\nimport { browser } from '$app/environment';\n\n// Store list of subscribed topic IDs\nexport const subscribedTopics = persistentStore<string[]>('learnflow-subscribed-topics', []);\n\n// Create stores\nexport const categories = writable<ForumCategory[]>([]);\nexport const topics = writable<ForumTopic[]>([]);\nexport const currentTopic = writable<ForumTopic | null>(null);\nexport const posts = writable<ForumPost[]>([]);\nexport const isLoading = writable<boolean>(false);\nexport const error = writable<string | null>(null);\nexport const activeTagFilter = writable<string | null>(null);\nexport const forumCategories = writable<ForumCategory[]>([]);\nexport const selectedCategory = writable<ForumCategory | null>(null);\n\n// Initialize categories\nexport async function loadCategories(): Promise<void> {\n  if (!browser) return;\n  \n  isLoading.set(true);\n  error.set(null);\n  \n  try {\n    const result = await getCategories();\n    categories.set(result);\n  } catch (err) {\n    console.error('Error loading forum categories:', err);\n    error.set('Failed to load forum categories');\n  } finally {\n    isLoading.set(false);\n  }\n}\n\n// Load topics for a category\nexport async function loadTopics(categoryId?: string): Promise<void> {\n  if (!browser) return;\n  \n  isLoading.set(true);\n  error.set(null);\n  \n  try {\n    // Call getTopics without parameter if categoryId is undefined\n    const result = await getTopics();\n    \n    // If there's a category ID, filter client-side\n    const filteredTopics = categoryId \n      ? result.filter(topic => topic.category_id === categoryId)\n      : result;\n      \n    topics.set(filteredTopics);\n  } catch (err) {\n    console.error('Error loading forum topics:', err);\n    error.set('Failed to load forum topics');\n  } finally {\n    isLoading.set(false);\n  }\n}\n\n// Load a specific topic and its posts\nexport async function loadTopic(topicId: string): Promise<void> {\n  if (!browser) return;\n  \n  isLoading.set(true);\n  error.set(null);\n  currentTopic.set(null);\n  posts.set([]);\n  \n  try {\n    const [topicResult, postsResult] = await Promise.all([\n      getTopic(topicId),\n      getPostsByTopicId(topicId)\n    ]);\n    \n    if (topicResult) {\n      currentTopic.set(topicResult);\n      posts.set(postsResult);\n    } else {\n      error.set('Topic not found');\n    }\n  } catch (err) {\n    console.error(`Error loading topic ${topicId}:`, err);\n    error.set('Failed to load topic');\n  } finally {\n    isLoading.set(false);\n  }\n}\n\n// Filter topics by tag\nexport async function filterTopicsByTag(tag: string): Promise<void> {\n  if (!browser) return;\n  \n  isLoading.set(true);\n  error.set(null);\n  activeTagFilter.set(tag);\n  \n  try {\n    // Use getTopics and filter client-side instead of using a non-existent getTopicsByTag function\n    const allTopics = await getTopics();\n    const filteredTopics = allTopics.filter(topic => topic.tags?.includes(tag));\n    topics.set(filteredTopics);\n  } catch (err) {\n    console.error(`Error loading topics with tag ${tag}:`, err);\n    error.set('Failed to load topics with the selected tag');\n  } finally {\n    isLoading.set(false);\n  }\n}\n\n// Clear tag filter\nexport function clearTagFilter(): void {\n  activeTagFilter.set(null);\n  loadTopics();\n}\n\n// Derived store for pinned topics\nexport const pinnedTopics = derived(topics, $topics => {\n  return $topics.filter(topic => topic.is_pinned);\n});\n\n// Derived store for recent topics\nexport const recentTopics = derived(topics, $topics => {\n  return $topics\n    .filter(topic => !topic.is_pinned)\n    .sort((a, b) => {\n      const dateA = a.updated_at || a.created_at;\n      const dateB = b.updated_at || b.created_at;\n      if (!dateA || !dateB) return 0;\n      return (dateB instanceof Date ? dateB.getTime() : 0) - \n             (dateA instanceof Date ? dateA.getTime() : 0);\n    })\n    .slice(0, 10);\n});\n\n// Get category by ID\nexport function getCategoryById(id: string): ForumCategory | undefined {\n  let result: ForumCategory | undefined;\n  \n  categories.subscribe(cats => {\n    result = cats.find(cat => cat.id === id);\n  })();\n  \n  return result;\n}"],"names":["subscribedTopics","persistentStore","categories","writable","topics","currentTopic","posts","isLoading","error","activeTagFilter","loadCategories","__async","result","getCategories","err","loadTopics","categoryId","getTopics","filteredTopics","topic","loadTopic","topicId","topicResult","postsResult","getTopic","getPostsByTopicId","filterTopicsByTag","tag","_a","clearTagFilter","pinnedTopics","derived","$topics","recentTopics","a","b","dateA","dateB","getCategoryById","id","cats","cat"],"mappings":"+UAYO,MAAMA,EAAmBC,EAA0B,8BAA+B,CAAE,CAAA,EAG9EC,EAAaC,EAA0B,CAAE,CAAA,EACzCC,EAASD,EAAuB,CAAE,CAAA,EAClCE,EAAeF,EAA4B,IAAI,EAC/CG,EAAQH,EAAsB,CAAE,CAAA,EAChCI,EAAYJ,EAAkB,EAAK,EACnCK,EAAQL,EAAwB,IAAI,EACpCM,EAAkBN,EAAwB,IAAI,EAK3D,SAAsBO,GAAgC,QAAAC,EAAA,sBAGpDJ,EAAU,IAAI,EAAI,EAClBC,EAAM,IAAI,IAAI,EAEV,GAAA,CACI,MAAAI,EAAS,MAAMC,EAAc,EACnCX,EAAW,IAAIU,CAAM,QACdE,EAAK,CACJ,QAAA,MAAM,kCAAmCA,CAAG,EACpDN,EAAM,IAAI,iCAAiC,CAAA,QAC3C,CACAD,EAAU,IAAI,EAAK,CAAA,CAEvB,GAGA,SAAsBQ,EAAWC,EAAoC,QAAAL,EAAA,sBAGnEJ,EAAU,IAAI,EAAI,EAClBC,EAAM,IAAI,IAAI,EAEV,GAAA,CAEI,MAAAI,EAAS,MAAMK,EAAU,EAGzBC,EAAiBF,EACnBJ,EAAO,UAAgBO,EAAM,cAAgBH,CAAU,EACvDJ,EAEJR,EAAO,IAAIc,CAAc,QAClBJ,EAAK,CACJ,QAAA,MAAM,8BAA+BA,CAAG,EAChDN,EAAM,IAAI,6BAA6B,CAAA,QACvC,CACAD,EAAU,IAAI,EAAK,CAAA,CAEvB,GAGA,SAAsBa,EAAUC,EAAgC,QAAAV,EAAA,sBAG9DJ,EAAU,IAAI,EAAI,EAClBC,EAAM,IAAI,IAAI,EACdH,EAAa,IAAI,IAAI,EACfC,EAAA,IAAI,EAAE,EAER,GAAA,CACF,KAAM,CAACgB,EAAaC,CAAW,EAAI,MAAM,QAAQ,IAAI,CACnDC,EAASH,CAAO,EAChBI,EAAkBJ,CAAO,CAAA,CAC1B,EAEGC,GACFjB,EAAa,IAAIiB,CAAW,EAC5BhB,EAAM,IAAIiB,CAAW,GAErBf,EAAM,IAAI,iBAAiB,QAEtBM,EAAK,CACZ,QAAQ,MAAM,uBAAuBO,CAAO,IAAKP,CAAG,EACpDN,EAAM,IAAI,sBAAsB,CAAA,QAChC,CACAD,EAAU,IAAI,EAAK,CAAA,CAEvB,GAGA,SAAsBmB,EAAkBC,EAA4B,QAAAhB,EAAA,sBAGlEJ,EAAU,IAAI,EAAI,EAClBC,EAAM,IAAI,IAAI,EACdC,EAAgB,IAAIkB,CAAG,EAEnB,GAAA,CAGI,MAAAT,GADY,MAAMD,EAAU,GACD,OAAOE,GAAS,OAAA,OAAAS,EAAAT,EAAM,OAAN,YAAAS,EAAY,SAASD,GAAI,EAC1EvB,EAAO,IAAIc,CAAc,QAClBJ,EAAK,CACZ,QAAQ,MAAM,iCAAiCa,CAAG,IAAKb,CAAG,EAC1DN,EAAM,IAAI,6CAA6C,CAAA,QACvD,CACAD,EAAU,IAAI,EAAK,CAAA,CAEvB,GAGO,SAASsB,GAAuB,CACrCpB,EAAgB,IAAI,IAAI,EACbM,EAAA,CACb,CAGa,MAAAe,EAAeC,EAAQ3B,EAAmB4B,GAC9CA,EAAQ,OAAgBb,GAAAA,EAAM,SAAS,CAC/C,EAGYc,EAAeF,EAAQ3B,EAAmB4B,GAC9CA,EACJ,OAAOb,GAAS,CAACA,EAAM,SAAS,EAChC,KAAK,CAACe,EAAGC,IAAM,CACR,MAAAC,EAAQF,EAAE,YAAcA,EAAE,WAC1BG,EAAQF,EAAE,YAAcA,EAAE,WAChC,MAAI,CAACC,GAAS,CAACC,EAAc,GACrBA,aAAiB,KAAOA,EAAM,QAAQ,EAAI,IAC1CD,aAAiB,KAAOA,EAAM,QAAA,EAAY,EAAA,CACnD,EACA,MAAM,EAAG,EAAE,CACf,EAGM,SAASE,EAAgBC,EAAuC,CACjE,IAAA3B,EAEJ,OAAAV,EAAW,UAAkBsC,GAAA,CAC3B5B,EAAS4B,EAAK,KAAYC,GAAAA,EAAI,KAAOF,CAAE,CAAA,CACxC,EAAE,EAEI3B,CACT"}