const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DI_EjB8G.js","./z6kK6n-3.js"])))=>i.map(i=>d[i]);
import{P as c,A as I,B as D,C as F,D as v,e as R,F as V,f as T,h as b,i as U,G as C,Q as L,j as N,k as O,m as S,n as G,p as Q,r as W,s as x,S as z,T as B,V as j,_ as k,t as q,v as K,x as M,y as $,z as H,E as J,H as X,I as Y,a as Z,c as ee,J as te,d as se,K as re,L as oe,M as ae,g as ne,N as ie,l as le,o as ue,q as ce,O as de,u as ge,w as fe}from"./DI_EjB8G.js";import{w as d}from"./B51PyqUg.js";import{s as me,t as pe,G as _e,w as ye,x as he,u as we,y as Pe,z as Ae}from"./z6kK6n-3.js";import{_ as g}from"./C1FmrZbK.js";const y=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:I,Bytes:D,CollectionReference:F,DocumentReference:v,DocumentSnapshot:R,FieldPath:V,FieldValue:T,Firestore:b,FirestoreError:U,GeoPoint:C,Query:L,QueryCompositeFilterConstraint:N,QueryConstraint:O,QueryDocumentSnapshot:S,QueryFieldFilterConstraint:G,QueryLimitConstraint:Q,QueryOrderByConstraint:W,QuerySnapshot:x,SnapshotMetadata:z,Timestamp:B,VectorValue:j,_AutoId:k,_ByteString:q,_DatabaseId:K,_DocumentKey:M,_EmptyAuthCredentialsProvider:$,_FieldPath:H,_cast:J,_logWarn:X,_validateIsNotUsedTogether:Y,addDoc:Z,collection:ee,connectFirestoreEmulator:te,doc:se,ensureFirestoreConfigured:re,executeWrite:oe,getDoc:ae,getDocs:ne,getFirestore:ie,limit:le,orderBy:ue,query:ce,setDoc:de,updateDoc:ge,where:fe},Symbol.toStringTag,{value:"Module"}));async function Ee(e){if(typeof window>"u")return null;const{getFirestore:t,doc:s,getDoc:r}=await g(async()=>{const{getFirestore:a,doc:i,getDoc:p}=await Promise.resolve().then(()=>y);return{getFirestore:a,doc:i,getDoc:p}},void 0,import.meta.url),{app:u}=await g(async()=>{const{app:a}=await import("./DI_EjB8G.js").then(i=>i.R);return{app:a}},__vite__mapDeps([0,1]),import.meta.url),f=t(u),m=s(f,"users",e),l=await r(m);return l.exists()?l.data():null}async function Ie(e){if(typeof window>"u")return;const{getFirestore:t,doc:s,setDoc:r}=await g(async()=>{const{getFirestore:l,doc:a,setDoc:i}=await Promise.resolve().then(()=>y);return{getFirestore:l,doc:a,setDoc:i}},void 0,import.meta.url),{app:u}=await g(async()=>{const{app:l}=await import("./DI_EjB8G.js").then(a=>a.R);return{app:l}},__vite__mapDeps([0,1]),import.meta.url),f=t(u),m=s(f,"users",e.uid);await r(m,e)}async function De(e,t){if(typeof window>"u")return;const{getFirestore:s,doc:r,updateDoc:u}=await g(async()=>{const{getFirestore:a,doc:i,updateDoc:p}=await Promise.resolve().then(()=>y);return{getFirestore:a,doc:i,updateDoc:p}},void 0,import.meta.url),{app:f}=await g(async()=>{const{app:a}=await import("./DI_EjB8G.js").then(i=>i.R);return{app:a}},__vite__mapDeps([0,1]),import.meta.url),m=s(f),l=r(m,"users",e);await u(l,t)}const h=d(null),w=d(!1),P=d(null);async function Fe(e,t,s){w.set(!0),P.set(null);try{let r=await Ee(e);if(!r){const u=Date.now();r={uid:e,email:t,displayName:s,createdAt:u,preferences:{enrollments:[],focusSessions:[],tasks:[],notes:""}},await Ie(r)}h.set(r)}catch(r){console.error("Error loading user profile:",r),P.set(r.message),h.set(null)}finally{w.set(!1)}}const Ue=De;let _=!1;function Ce(){if(_){console.log("Auth already initialized, skipping");return}return o.set(!0),console.log("Initializing auth listener"),me(c,t=>{t?(console.log("Auth state changed: User authenticated",{uid:t.uid,email:t.email,displayName:t.displayName}),A.set(!0),E.set(t),Fe(t.uid,t.email||"",t.displayName||void 0).catch(s=>console.error("Failed to load user profile:",s))):(console.log("Auth state changed: User not authenticated"),A.set(!1),E.set(null)),o.set(!1),_=!0},t=>{console.error("Auth state change error:",t),n.set(t.message),o.set(!1),_=!0})}async function Le(e,t,s){o.set(!0),n.set(null),console.log("Attempting to register user:",{email:e,displayName:s});try{const r=await he(c,e,t);r.user&&(await we(r.user,{displayName:s}),console.log("User registered successfully"))}catch(r){throw console.error("Registration error:",r),n.set(r.message),r}finally{o.set(!1)}}async function Ne(e,t){o.set(!0),n.set(null),console.log("Attempting to login user:",{email:e});try{const s=await pe(c,e,t);console.log("Login successful:",{uid:s.user.uid,email:s.user.email,displayName:s.user.displayName,emailVerified:s.user.emailVerified})}catch(s){throw console.error("Login error:",s),n.set(s.message),s}finally{o.set(!1)}}async function Oe(){o.set(!0),n.set(null),console.log("Attempting Google sign-in");try{const e=new _e,t=await ye(c,e);console.log("Google sign-in successful:",{uid:t.user.uid,email:t.user.email,displayName:t.user.displayName})}catch(e){throw console.error("Google sign-in error:",e),n.set(e.message),e}finally{o.set(!1)}}async function ve(){o.set(!0),n.set(null),console.log("Logging out user");try{await Ae(c),console.log("Logout successful")}catch(e){throw console.error("Logout error:",e),n.set(e.message),e}finally{o.set(!1)}}async function Se(e){o.set(!0),n.set(null),console.log("Requesting password reset for:",{email:e});try{await Pe(c,e),console.log("Password reset email sent")}catch(t){throw console.error("Password reset error:",t),n.set(t.message),t}finally{o.set(!1)}}function Ge(){const e=c.currentUser;return console.log("Getting current user:",e?{uid:e.uid,email:e.email,displayName:e.displayName}:"No user"),e}const A=d(!1),E=d(null),o=d(!0),n=d(null),Qe=ve;export{w as a,h as b,Ne as c,Qe as d,Ue as e,n as f,Ge as g,Oe as h,A as i,Se as j,ve as k,o as l,Ce as m,Le as r,E as u};
