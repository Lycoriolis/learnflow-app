{"version":3,"file":"2.Biji03Tc.js","sources":["../../../../../../src/routes/(protected)/+layout.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { goto } from '$app/navigation';\n  import { page } from '$app/stores';\n  import { isAuthenticated, user, loading, authError } from '$lib/stores/authStore.js';\n  import { fade } from 'svelte/transition';\n  import { onMount, onDestroy } from 'svelte';\n  import { getCurrentUser } from '$lib/authService';\n\n  let checked = false;\n  let authCheckComplete = false;\n  let localError = '';\n  \n  // Session timeout check interval (5 minutes)\n  const SESSION_CHECK_INTERVAL = 5 * 60 * 1000;\n  let sessionCheckInterval: ReturnType<typeof setInterval> | null = null;\n  \n  // Initial auth check function\n  async function checkAuthentication() {\n    try {\n      if (!$isAuthenticated && !$loading) {\n        // Double-check with Firebase directly in case store is out of sync\n        const currentUser = await getCurrentUser();\n        if (!currentUser) {\n          console.warn('User not authenticated, redirecting to login');\n          redirectToLogin();\n        }\n      }\n    } catch (error) {\n      console.error('Authentication check failed:', error);\n      localError = 'Failed to verify authentication status';\n    } finally {\n      authCheckComplete = true;\n      checked = true;\n    }\n  }\n  \n  // Redirect to login with return URL\n  function redirectToLogin() {\n    goto('/login?redirect=' + encodeURIComponent($page.url.pathname));\n  }\n  \n  // Periodic session validation to catch auth timeouts\n  function startSessionCheck() {\n    sessionCheckInterval = setInterval(async () => {\n      try {\n        const currentUser = await getCurrentUser();\n        if (!currentUser && $isAuthenticated) {\n          console.warn('Session expired during active use, redirecting to login');\n          redirectToLogin();\n        }\n      } catch (error) {\n        console.error('Session check failed:', error);\n      }\n    }, SESSION_CHECK_INTERVAL);\n  }\n  \n  onMount(() => {\n    console.log('Protected layout mounted', { \n      isAuthenticated: $isAuthenticated, \n      loading: $loading,\n      user: $user ? { email: $user.email } : null \n    });\n    \n    checkAuthentication();\n    startSessionCheck();\n  });\n  \n  onDestroy(() => {\n    if (sessionCheckInterval) {\n      clearInterval(sessionCheckInterval);\n    }\n  });\n  \n  // Watch for auth state changes\n  $: if (!$loading && !checked) {\n    checked = true;\n    console.log('Auth check in protected layout:', {\n      isAuthenticated: $isAuthenticated,\n      loading: $loading\n    });\n    \n    if (!$isAuthenticated) {\n      console.warn('User not authenticated, redirecting to login');\n      redirectToLogin();\n    }\n  }\n  \n  // Watch for auth errors\n  $: if ($authError) {\n    localError = $authError;\n  }\n</script>\n\n{#if $loading || !authCheckComplete}\n  <div in:fade class=\"fixed inset-0 bg-white dark:bg-gray-900 z-50 flex justify-center items-center\">\n    <div class=\"flex flex-col items-center\">\n      <div class=\"w-16 h-16 border-4 border-t-indigo-500 border-indigo-200 rounded-full animate-spin\"></div>\n      <p class=\"mt-4 text-gray-600 dark:text-gray-400\">Verifying authentication...</p>\n    </div>\n  </div>\n{:else if $isAuthenticated}\n  {#if localError}\n    <div class=\"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4\" role=\"alert\">\n      <p class=\"font-bold\">Warning</p>\n      <p>{localError}</p>\n    </div>\n  {/if}\n  <slot />\n{:else}\n  <div in:fade class=\"flex justify-center items-center min-h-screen bg-gray-100 dark:bg-gray-900\">\n    <div class=\"bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg max-w-md w-full\">\n      <div class=\"text-center\">\n        <div class=\"mb-4 flex justify-center\">\n          <div class=\"h-16 w-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center\">\n            <i class=\"fas fa-lock text-red-600 dark:text-red-400 text-2xl\"></i>\n          </div>\n        </div>\n        <h2 class=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">Authentication Required</h2>\n        <p class=\"text-gray-600 dark:text-gray-400 mb-6\">\n          You need to be logged in to access this page.\n        </p>\n        {#if localError}\n          <div class=\"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4\" role=\"alert\">\n            <p>{localError}</p>\n          </div>\n        {/if}\n        <a href=\"/login?redirect={encodeURIComponent($page.url.pathname)}\" class=\"inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded\">\n          Go to Login\n        </a>\n      </div>\n    </div>\n  </div>\n{/if}"],"names":["checked","authCheckComplete","localError","SESSION_CHECK_INTERVAL","sessionCheckInterval","checkAuthentication","__async","$isAuthenticated","$loading","getCurrentUser","redirectToLogin","error","$.set","goto","$page","startSessionCheck","onMount","$user","onDestroy","$.get","$authError","$$render","consequent_1","consequent_3","consequent_2","alternate_1","consequent","alternate"],"mappings":"08EAQM,IAAAA,IAAU,EAAK,EACfC,IAAoB,EAAK,EACzBC,IAAa,EAAE,EAGb,MAAAC,EAAyB,EAAI,GAAK,IACpC,IAAAC,EAA8D,KAGnD,SAAAC,GAAsB,QAAAC,EAAA,sBAC/B,GAAA,EACGC,EAAgB,GAAA,CAAKC,aAEEC,EAAc,KAEtC,QAAQ,KAAK,8CAA8C,EAC3DC,EAAe,GAGpB,OAAQC,EAAO,CACd,QAAQ,MAAM,+BAAgCA,CAAK,EACnDC,EAAAV,EAAa,wCAAwC,CACvD,QAAU,CACRU,EAAAX,EAAoB,EAAI,EACxBW,EAAAZ,EAAU,EAAI,CAChB,CACF,GAGS,SAAAU,GAAkB,CACzBG,GAAK,mBAAqB,mBAAmBC,EAAK,EAAC,IAAI,QAAQ,CAAA,CACjE,CAGS,SAAAC,GAAoB,CAC3BX,EAAuB,YAAwB,IAAAE,EAAA,sBACzC,GAAA,SACwBG,EAAc,IACpBF,MAClB,QAAQ,KAAK,yDAAyD,EACtEG,EAAe,EAElB,OAAQC,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,CAC9C,CACD,GAAER,EACL,CAEAa,GAAc,IAAA,CACZ,QAAQ,IAAI,2BAA0B,CACpC,gBAAiBT,EAAgB,EACjC,QAASC,EAAQ,EACjB,KAAMS,EAAK,EAAK,CAAA,MAAOA,EAAK,EAAC,OAAU,OAGzCZ,EAAmB,EACnBU,EAAiB,EAClB,EAEDG,GAAgB,IAAA,CACVd,GACF,cAAcA,CAAoB,EAErC,6BAGOI,EAAQ,GAAA,CAAAW,EAAKnB,CAAO,IAC1BY,EAAAZ,EAAU,EAAI,EACd,QAAQ,IAAI,kCAAiC,CAC3C,gBAAiBO,EAAgB,EACjC,QAASC,EAAC,IAGPD,EAAgB,IACnB,QAAQ,KAAK,8CAA8C,EAC3DG,EAAe,qBAKZU,EAAU,GACfR,EAAAV,EAAakB,GAAU,oLAejBlB,CAAU,CAAA,CAAA,oBAHbA,CAAU,GAAAmB,EAAAC,CAAA,sJAsBDpB,CAAU,CAAA,CAAA,oBAFbA,CAAU,GAAAmB,EAAAE,CAAA,qFAKW,IAAA,mBAAmBT,IAAM,IAAI,QAAQ,oCA1B7DP,EAAgB,EAAAc,EAAAG,CAAA,EAAAH,EAAAI,EAAA,EAAA,gBAPrBjB,QAAaP,CAAiB,EAAAoB,EAAAK,CAAA,EAAAL,EAAAM,EAAA,EAAA"}