import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as ce,c as o,n as te,r as i,e as l,t as I,i as ae,g as t,b as ue,m as u,s,l as ye,a as he,$ as we}from"../chunks/D8Zr53n5.js";import{s as ve}from"../chunks/UpSy6tP0.js";import{i as se}from"../chunks/BAqAra_5.js";import{t as D,a as A}from"../chunks/ByokzzJe.js";import{e as G,h as xe}from"../chunks/CCLz0Z0F.js";import{s as Ce}from"../chunks/Cw_GgyMt.js";import{t as Te,f as ke}from"../chunks/CwmK-V57.js";import{i as pe}from"../chunks/BzVavbfz.js";import{p as R}from"../chunks/D0guHZRM.js";import{s as Fe,a as de}from"../chunks/CYIMW-vo.js";import{s as oe,F as Se,a as Le,b as $e,C as Ae}from"../chunks/BJI8ZFFo.js";import{e as De,i as Pe}from"../chunks/8AErAcLY.js";import{r as Oe,a as Ve}from"../chunks/DpNHaJTn.js";import{b as ie}from"../chunks/dleV8ATl.js";import{c as Ie,o as Re}from"../chunks/DyX_nzx0.js";import{u as Me}from"../chunks/QfzvdxsM.js";var Qe=D("<option> </option>"),Ue=D('<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700 p-4 mb-8"><div class="flex flex-col md:flex-row gap-4"><div class="relative flex-grow"><input type="text" class="w-full pl-10 pr-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Search topics..."> <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i class="fas fa-search text-gray-400"></i></div></div> <div class="flex flex-col sm:flex-row gap-2 sm:gap-4"><div class="relative"><select class="appearance-none pl-4 pr-10 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"><option>All Categories</option><!></select> <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"><i class="fas fa-chevron-down text-gray-400"></i></div></div> <div class="relative"><select class="appearance-none pl-4 pr-10 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"><option>Latest Activity</option><option>Created</option><option>Most Viewed</option><option>Most Replies</option><option>Most Upvoted</option></select> <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"><i class="fas fa-chevron-down text-gray-400"></i></div></div> <div class="relative"><select class="appearance-none pl-4 pr-10 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"><option>All Levels</option><option>Beginner</option><option>Intermediate</option><option>Advanced</option></select> <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"><i class="fas fa-chevron-down text-gray-400"></i></div></div></div></div></div>');function je(re,m){ce(m,!1);let M=R(m,"categories",24,()=>[]),K=R(m,"filterCategory",12),Q=R(m,"searchQuery",8),U=R(m,"sortOption",12),j=R(m,"difficultyFilter",12);const k=Ie();function d(e){k("search",e.target.value)}function h(e){k("category",e.target.value)}function X(e){k("sort",e.target.value)}function b(e){k("difficulty",e.target.value)}pe();var p=Ue(),v=o(p),f=o(v),F=o(f);Oe(F),te(2),i(f);var S=l(f,2),w=o(S),x=o(w);I(()=>{K(),ae(()=>{M()})});var L=o(x);L.value=(L.__value="all")==null?"":"all";var P=l(L);De(P,1,M,Pe,(e,r)=>{var n=Qe(),c={},_=o(n,!0);i(n),I(()=>{c!==(c=t(r).id)&&(n.value=(n.__value=t(r).id)==null?"":t(r).id),ve(_,t(r).name)}),A(e,n)}),i(x),te(2),i(w);var $=l(w,2),g=o($);I(()=>{U(),ae(()=>{})});var B=o(g);B.value=(B.__value="latest")==null?"":"latest";var E=l(B);E.value=(E.__value="created")==null?"":"created";var N=l(E);N.value=(N.__value="popular")==null?"":"popular";var z=l(N);z.value=(z.__value="most-replies")==null?"":"most-replies";var Z=l(z);Z.value=(Z.__value="most-upvoted")==null?"":"most-upvoted",i(g),te(2),i($);var H=l($,2),C=o(H);I(()=>{j(),ae(()=>{})});var J=o(C);J.value=(J.__value="all")==null?"":"all";var W=l(J);W.value=(W.__value="beginner")==null?"":"beginner";var Y=l(W);Y.value=(Y.__value="intermediate")==null?"":"intermediate";var q=l(Y);q.value=(q.__value="advanced")==null?"":"advanced",i(C),te(2),i(H),i(S),i(v),i(p),I(()=>Ve(F,Q())),G("input",F,d),ie(x,K),G("change",x,h),ie(g,U),G("change",g,X),ie(C,j),G("change",C,b),A(re,p),ue()}var Be=D('<div class="flex justify-center items-center h-64 svelte-ea7bem"><div class="loader svelte-ea7bem"></div></div>'),Ee=D('<div class="fixed inset-0 bg-black bg-opacity-40 z-50 flex items-center justify-center svelte-ea7bem"><div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-lg relative svelte-ea7bem"><button class="absolute top-2 right-2 text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 svelte-ea7bem"><i class="fas fa-times svelte-ea7bem"></i></button> <!></div></div>'),Ne=D("<div> </div>"),ze=D('<div class="svelte-ea7bem"><!> <!> <!> <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 svelte-ea7bem"><div class="lg:col-span-9 svelte-ea7bem"><!></div> <div class="lg:col-span-3 svelte-ea7bem"><!></div></div> <!></div>'),He=D('<div class="container mx-auto px-4 py-8 max-w-7xl svelte-ea7bem"><!></div>');function ct(re,m){var q;ce(m,!1);const[M,K]=Fe(),Q=()=>de(oe,"$subscribedTopics",M),U=()=>de(Me,"$user",M),j=u();let k=R(m,"data",8),d=u(k().topics),h=k().categories;console.log("Loaded categories:",h);const X="test-topic-1";t(d).some(e=>e.id===X)||s(d,[{id:X,title:"Test Topic: Welcome to the Forum!",category:((q=h[0])==null?void 0:q.id)||"general",author:{id:"test-user",name:"Test User",avatar:""},createdAt:new Date().toISOString(),repliesCount:0,viewsCount:0,upvotes:0,downvotes:0,userVote:null,tags:["test","welcome"],isPinned:!0,isLocked:!1,difficulty:"beginner",resourceLinks:[],hasCodeExamples:!1,isResolved:!1},...t(d)]);let b=u("all"),p=u(""),v=u("latest"),f=u("all"),F=u(!1),S=u(!1),w=u(null),x=u(null),L=u(null),P=u(""),$=u("");function g(e,r){s(P,e),s($,r),setTimeout(()=>{s(P,""),s($,"")},2e3)}function B(e){const r=e.detail;s(d,[r,...t(d)])}async function E(e,r){s(w,e);const n=t(d).findIndex(y=>y.id===e);if(n===-1)return;const c=t(d)[n],_=U();if(!_||!_.uid){g("You must be logged in to vote.","error"),s(w,null);return}const O=r==="up"?1:-1;try{const y=await fetch(`/api/forum/topics/${e}/vote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:_.uid,vote_type:O})});if(y.ok){const V=await y.json();c.upvotes=V.upvotes,c.downvotes=V.downvotes,c.userVote===r?c.userVote=null:c.userVote=r,s(d,[...t(d)]),g("Vote recorded!","success")}else g("Failed to vote.","error")}catch{g("Error voting.","error")}finally{s(w,null)}}function N(e){s(x,e),Q().includes(e)||(oe.update(r=>[...r,e]),g("Subscribed!","success")),s(x,null)}function z(e){s(L,e),oe.update(r=>r.filter(n=>n!==e)),g("Unsubscribed!","success"),s(L,null)}function Z(){console.log("New Topic button clicked"),s(F,!0)}let H=u(!0);Re(()=>{setTimeout(()=>{s(H,!1)},800)}),ye(()=>(t(S),t(d),Q(),t(b),t(p),t(f),t(v)),()=>{s(j,t(S)?t(d).filter(e=>Q().includes(e.id)):t(d).filter(e=>{const r=t(b)==="all"||e.category===t(b),n=t(p)===""||e.title.toLowerCase().includes(t(p).toLowerCase())||e.tags&&e.tags.some(O=>O.toLowerCase().includes(t(p).toLowerCase())),c=t(f)==="all"||e.difficulty===t(f),_=e.isResolved||!e.isResolved||e.isResolved===void 0;return r&&n&&c&&_}).sort((e,r)=>{if(e.isPinned&&!r.isPinned)return-1;if(!e.isPinned&&r.isPinned)return 1;if(t(v)==="latest"){const n=e.lastPost?new Date(e.lastPost.date):new Date(e.createdAt);return(r.lastPost?new Date(r.lastPost.date):new Date(e.createdAt)).getTime()-n.getTime()}else{if(t(v)==="popular")return r.viewsCount-e.viewsCount;if(t(v)==="most-replies")return r.repliesCount-e.repliesCount;if(t(v)==="created")return new Date(r.createdAt).getTime()-new Date(e.createdAt).getTime();if(t(v)==="most-upvoted")return(r.upvotes||0)-(e.upvotes||0)}return 0}))}),he(),pe();var C=He();xe(e=>{we.title="Forums | LearnFlow"});var J=o(C);{var W=e=>{var r=Be();A(e,r)},Y=e=>{var r=ze(),n=o(r);Se(n,{$$events:{newTopic:Z,toggleSubscriptions:()=>s(S,!t(S))}});var c=l(n,2);{var _=a=>{var T=Ee(),ee=o(T),le=o(ee),_e=l(le,2);Ae(_e,{categories:h,$$events:{topicCreated:B}}),i(ee),i(T),G("click",le,()=>s(F,!1)),A(a,T)};se(c,a=>{t(F)&&a(_)})}var O=l(c,2);je(O,{categories:h,get filterCategory(){return t(b)},set filterCategory(a){s(b,a)},get searchQuery(){return t(p)},set searchQuery(a){s(p,a)},get sortOption(){return t(v)},set sortOption(a){s(v,a)},get difficultyFilter(){return t(f)},set difficultyFilter(a){s(f,a)},$$events:{search:({detail:a})=>s(p,a),category:({detail:a})=>s(b,a),sort:({detail:a})=>s(v,a),difficulty:({detail:a})=>s(f,a)},$$legacy:!0});var y=l(O,2),V=o(y),ge=o(V);Le(ge,{get topics(){return t(j)},categories:h,get votingTopicId(){return t(w)},get subscribingTopicId(){return t(x)},get unsubscribingTopicId(){return t(L)},get user(){return U()},$$events:{subscribe:({detail:a})=>N(a),unsubscribe:({detail:a})=>z(a),vote:({detail:a})=>E(a.id,a.type)}}),i(V);var ne=l(V,2),fe=o(ne);$e(fe,{categories:h,get filterCategory(){return t(b)}}),i(ne),i(y);var me=l(y,2);{var be=a=>{var T=Ne(),ee=o(T,!0);i(T),I(()=>{Ce(T,1,`fixed bottom-4 right-4 p-4 rounded-lg shadow-lg ${t($)==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,"svelte-ea7bem"),ve(ee,t(P))}),A(a,T)};se(me,a=>{t(P)&&a(be)})}i(r),Te(1,r,()=>ke,()=>({duration:300})),A(e,r)};se(J,e=>{t(H)?e(W):e(Y,!1)})}i(C),A(re,C),ue(),K()}export{ct as component};
