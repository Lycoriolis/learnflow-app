import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as H,l as z,a as et,f as rt,b as K,s as a,m,g as t,c as o,e as u,r,t as T,j as G}from"../chunks/D8Zr53n5.js";import{i as Q}from"../chunks/BzVavbfz.js";import{p as at}from"../chunks/D0guHZRM.js";import{s as E}from"../chunks/UpSy6tP0.js";import{i as F}from"../chunks/BAqAra_5.js";import{e as yt,i as xt}from"../chunks/8AErAcLY.js";import{c as wt,a as n,t as p}from"../chunks/ByokzzJe.js";import{r as kt,e as ot}from"../chunks/CCLz0Z0F.js";import{s as st,a as it}from"../chunks/CYIMW-vo.js";import{b as Pt}from"../chunks/Djn-aou_.js";import{p as Rt}from"../chunks/Bfc47y5P.js";import{c as $t,o as St}from"../chunks/DyX_nzx0.js";import{u as nt}from"../chunks/QfzvdxsM.js";import{M as jt}from"../chunks/DYIbtIuY.js";var Dt=p('<div class="new-post-form"><textarea class="w-full p-3 border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="4" placeholder="Write your reply here..."></textarea> <button class="mt-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed">Post Reply</button></div>'),Lt=p('<p class="text-gray-600 dark:text-gray-400">You must be <a href="/login" class="text-indigo-600 hover:underline">logged in</a> to post a reply.</p>');function Mt(R,f){H(f,!1);const[h,$]=st(),g=()=>it(nt,"$user",h),y=m();let s=m("");const l=$t();function c(){t(s).trim()&&(l("newPost",{content:t(s).trim()}),a(s,""))}z(()=>g(),()=>{a(y,g())}),et(),Q();var x=wt(),_=rt(x);{var U=v=>{var i=Dt(),S=o(i);kt(S);var N=u(S,2);r(i),T(b=>N.disabled=b,[()=>!t(s).trim()],G),Pt(S,()=>t(s),b=>a(s,b)),ot("click",N,Rt(c)),n(v,i)},w=v=>{var i=Lt();n(v,i)};F(_,v=>{var i;(i=t(y))!=null&&i.uid?v(U):v(w,!1)})}n(R,x),K(),$()}var At=p("<p>Loading replies...</p>"),Et=p('<p class="text-red-500"> </p>'),Ft=p('<li class="post p-3 border rounded bg-white dark:bg-gray-700 shadow-sm"><p class="text-sm text-gray-600 dark:text-gray-400 mb-1"> </p> <div class="post-content"><!></div></li>'),Nt=p('<div class="flex justify-center mt-4"><button class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded text-sm font-medium">Load more replies</button></div>'),Ot=p('<ul class="space-y-4"></ul> <!>',1),Tt=p("<p>No replies yet.</p>"),Ut=p('<div class="forum-topic p-4"><h1 class="text-3xl font-bold mb-2"> </h1> <p class="text-sm text-gray-600 dark:text-gray-400 mb-4"> </p> <div class="topic-content mb-6 p-4 border rounded bg-gray-50 dark:bg-gray-800"><p> </p></div> <h2 class="text-2xl font-semibold mb-4">Replies</h2> <!> <div class="mt-8"><h3 class="text-xl font-semibold mb-3">Add a Reply</h3> <!></div></div>');function Yt(R,f){H(f,!1);const[h,$]=st(),g=()=>it(nt,"$user",h),y=m(),s=m();let l=at(f,"topic",24,()=>({id:"",title:"Loading...",content:"",author:"",createdAt:new Date().toISOString()})),c=m([]),x=m(!0),_=m(""),U=10,w=m(1),v=t(c).length>t(y).length;async function i(){a(x,!0),a(_,"");try{const e=await fetch(`/api/forum/posts?topic_id=${l().id}`);e.ok?a(c,await e.json()):a(_,"Failed to load replies.")}catch{a(_,"Error loading replies.")}finally{a(x,!1)}}function S(){a(w,t(w)+1)}St(()=>{l().id&&i()});async function N(e){const j=e.detail.content;if(!t(s)||!t(s).uid){alert("You must be logged in to reply.");return}try{const D=await fetch("/api/forum/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic_id:l().id,author_id:t(s).uid,content:j})});if(D.ok){const C=await D.json();a(c,[...t(c),C])}else alert("Failed to post reply.")}catch{alert("Error posting reply.")}}z(()=>(t(c),t(w)),()=>{a(y,t(c).slice(0,U*t(w)))}),z(()=>g(),()=>{a(s,g())}),et(),Q();var b=Ut(),Y=o(b),lt=o(Y,!0);r(Y);var q=u(Y,2),ct=o(q);r(q);var B=u(q,2),V=o(B),dt=o(V,!0);r(V),r(B);var X=u(B,4);{var pt=e=>{var j=At();n(e,j)},vt=(e,j)=>{{var D=k=>{var L=Et(),I=o(L,!0);r(L),T(()=>E(I,t(_))),n(k,L)},C=(k,L)=>{{var I=P=>{var O=Ot(),J=rt(O);yt(J,5,()=>t(y),xt,(M,d)=>{var A=Ft(),W=o(A),_t=o(W);r(W);var tt=u(W,2),bt=o(tt);jt(bt,{get content(){return t(d).content}}),r(tt),r(A),T(ht=>E(_t,`By ${(t(d).author_name||t(d).author)??""} on ${ht??""}`),[()=>new Date(t(d).created_at||t(d).createdAt).toLocaleString()],G),n(M,A)}),r(J);var ft=u(J,2);{var gt=M=>{var d=Nt(),A=o(d);r(d),ot("click",A,S),n(M,d)};F(ft,M=>{v&&M(gt)})}n(P,O)},mt=P=>{var O=Tt();n(P,O)};F(k,P=>{t(c).length>0?P(I):P(mt,!1)},L)}};F(e,k=>{t(_)?k(D):k(C,!1)},j)}};F(X,e=>{t(x)?e(pt):e(vt,!1)})}var Z=u(X,2),ut=u(o(Z),2);Mt(ut,{$$events:{newPost:N}}),r(Z),r(b),T(e=>{E(lt,l().title),E(ct,`Started by ${l().author??""} on ${e??""}`),E(dt,l().content)},[()=>new Date(l().createdAt).toLocaleString()],G),n(R,b),K(),$()}function re(R,f){H(f,!1);let h=at(f,"data",8),$=h().topic,g=h().posts;Q(),Yt(R,{topic:$,posts:g}),K()}export{re as component};
