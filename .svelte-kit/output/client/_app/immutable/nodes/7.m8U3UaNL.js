import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{p as De,m as R,b as Fe,$ as qe,e as s,c as o,g as e,r,s as n,t as k,i as le,at as Q,j as Ne}from"../chunks/D8Zr53n5.js";import{s as b}from"../chunks/UpSy6tP0.js";import{i as Y}from"../chunks/BAqAra_5.js";import{e as U,i as X}from"../chunks/8AErAcLY.js";import{t as T,a as E}from"../chunks/ByokzzJe.js";import{h as Re,e as w}from"../chunks/CCLz0Z0F.js";import{r as ne}from"../chunks/DpNHaJTn.js";import{s as $e}from"../chunks/Cw_GgyMt.js";import{t as je,f as Ae}from"../chunks/CwmK-V57.js";import{b as ce}from"../chunks/Djn-aou_.js";import{b as ue}from"../chunks/dleV8ATl.js";import{p as Se}from"../chunks/Bfc47y5P.js";import{i as Oe}from"../chunks/BzVavbfz.js";import{p as Me}from"../chunks/D0guHZRM.js";import{g as be}from"../chunks/BMc8ARJA.js";import{g as pe,C as z,u as ve}from"../chunks/B19BcPMY.js";async function Z(G,D={}){const $={credentials:"same-origin",...D,headers:{"Content-Type":"application/json",...D.headers}};if(D.method&&D.method!=="GET"){const l=pe();if(l)$.headers[z]=l;else try{const u=(await fetch("/api/csrf/refresh",{credentials:"same-origin"})).headers.get(z);if(u)$.headers[z]=u;else return{error:"CSRF token required",status:401}}catch{return{error:"Failed to obtain CSRF token",status:500}}}try{const l=await fetch(G,$);if(ve(l),(l.status===401||l.status===403)&&l.headers.get("X-CSRF-Error")==="true")try{await fetch("/api/csrf/refresh",{credentials:"same-origin"});const p=pe();if(p){$.headers[z]=p;const u=await fetch(G,$);ve(u);try{return{data:await u.json(),status:u.status}}catch{return{status:u.status}}}}catch{}try{return{data:await l.json(),status:l.status}}catch{return{status:l.status}}}catch(l){return console.error("Request failed:",l),{error:l instanceof Error?l.message:"Network request failed",status:0}}}var Ge=T('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 relative"><span class="block sm:inline"> </span> <button class="absolute top-0 right-0 px-4 py-3"><i class="fas fa-times"></i></button></div>'),Ie=T('<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4 relative"><span class="block sm:inline"> </span> <button class="absolute top-0 right-0 px-4 py-3"><i class="fas fa-times"></i></button></div>'),Le=T("<option> </option>"),Be=T("<option> </option>"),Pe=T('<div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4"><h3 class="text-lg font-medium mb-3">Create New Category</h3> <form><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category Name</label> <input id="name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required></div> <div><label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label> <input id="description" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" required></div> <div><label for="icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Icon</label> <div class="flex items-center space-x-2"><select id="icon" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></select> <div class="w-10 h-10 flex items-center justify-center bg-gray-100 dark:bg-gray-600 rounded-md"><i></i></div></div></div> <div><label for="color" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Color</label> <select id="color" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"></select></div></div> <div class="flex justify-end space-x-2"><button type="button" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">Cancel</button> <button type="submit" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-md disabled:opacity-50"> </button></div></form></div>'),He=T('<tr class="hover:bg-gray-100 dark:hover:bg-gray-700"><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm space-x-2"><button class="text-blue-600 hover:underline">Edit</button> <button class="text-red-600 hover:underline">Delete</button></td></tr>'),Qe=T('<tr class="hover:bg-gray-100 dark:hover:bg-gray-700"><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm"> </td><td class="border px-4 py-2 text-sm space-x-2"><button class="text-blue-600 hover:underline">Edit</button> <button class="text-red-600 hover:underline">Delete</button></td></tr>'),Ue=T('<div class="container mx-auto p-4"><h1 class="text-2xl font-bold mb-4">Forum Management</h1> <!> <!> <div class="flex justify-between items-center mb-2"><h2 class="text-xl font-semibold">Categories</h2> <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md"><i class="fas fa-plus mr-1"></i> New Category</button></div> <!> <table class="min-w-full bg-white dark:bg-gray-800 mb-6"><thead><tr><th class="px-4 py-2">ID</th><th class="px-4 py-2">Name</th><th class="px-4 py-2">Description</th><th class="px-4 py-2">Actions</th></tr></thead><tbody></tbody></table> <h2 class="text-xl font-semibold mt-6 mb-2">Topics</h2> <table class="min-w-full bg-white dark:bg-gray-800"><thead><tr><th class="px-4 py-2">Title</th><th class="px-4 py-2">Category</th><th class="px-4 py-2">Author</th><th class="px-4 py-2">Created</th><th class="px-4 py-2">Actions</th></tr></thead><tbody></tbody></table></div>');function ct(G,D){De(D,!1);let l=Me(D,"data",8)(),p=R(l.topics),u=R(l.categories),I=R(!1),i=R({name:"",description:"",icon:"fa-folder",color:"blue"}),L=R(!1),j=R(""),A=R("");const me=[{value:"blue",label:"Blue"},{value:"green",label:"Green"},{value:"red",label:"Red"},{value:"purple",label:"Purple"},{value:"orange",label:"Orange"},{value:"indigo",label:"Indigo"},{value:"gray",label:"Gray"}],ge=[{value:"fa-folder",label:"Folder"},{value:"fa-code",label:"Code"},{value:"fa-question-circle",label:"Question"},{value:"fa-book",label:"Book"},{value:"fa-graduation-cap",label:"Education"},{value:"fa-users",label:"Users"},{value:"fa-cogs",label:"Settings"},{value:"fa-laptop",label:"Computer"},{value:"fa-chart-bar",label:"Chart"}];function fe(a){be(`/admin/forums/topic/${a}/edit`)}async function ye(a){if(confirm("Delete topic?"))try{await Z(`/api/forum/topics/${a}`,{method:"DELETE"}),n(p,e(p).filter(t=>t.id!==a)),S("Topic deleted successfully","success")}catch(t){console.error("Error deleting topic:",t),S(t.message||"Error deleting topic","error")}}function he(a){be(`/admin/forums/category/${a}/edit`)}async function xe(a){if(confirm("Delete category? This will also delete all topics in this category."))try{await Z(`/api/forum/categories/${a}`,{method:"DELETE"}),n(u,e(u).filter(t=>t.id!==a)),n(p,e(p).filter(t=>t.category!==a)),S("Category deleted successfully","success")}catch(t){console.error("Error deleting category:",t),S(t.message||"Error deleting category","error")}}async function _e(){n(L,!0),n(j,""),n(A,"");try{if(!e(i).name||!e(i).description)throw new Error("Name and description are required");const a=await Z("/api/forum/categories",{method:"POST",body:e(i)});n(u,[...e(u),a]),S("Category created successfully!","success"),ee()}catch(a){console.error("Error creating category:",a),S(a.message||"An unexpected error occurred","error")}finally{n(L,!1)}}function ee(){n(i,{name:"",description:"",icon:"fa-folder",color:"blue"}),n(I,!1)}function S(a,t){t==="success"?(n(A,a),setTimeout(()=>{n(A,"")},3e3)):(n(j,a),setTimeout(()=>{n(j,"")},5e3))}Oe();var B=Ue();Re(a=>{qe.title="Manage Forums | Admin"});var te=s(o(B),2);{var ke=a=>{var t=Ge(),d=o(t),c=o(d,!0);r(d);var v=s(d,2);r(t),k(()=>b(c,e(j))),w("click",v,()=>n(j,"")),E(a,t)};Y(te,a=>{e(j)&&a(ke)})}var re=s(te,2);{var we=a=>{var t=Ie(),d=o(t),c=o(d,!0);r(d);var v=s(d,2);r(t),k(()=>b(c,e(A))),w("click",v,()=>n(A,"")),E(a,t)};Y(re,a=>{e(A)&&a(we)})}var J=s(re,2),Ce=s(o(J),2);r(J);var ae=s(J,2);{var Ee=a=>{var t=Pe(),d=s(o(t),2),c=o(d),v=o(c),f=s(o(v),2);ne(f),r(v);var F=s(v,2),y=s(o(F),2);ne(y),r(F);var q=s(F,2),h=s(o(q),2),x=o(h);k(()=>{e(i),le(()=>{})}),U(x,5,()=>ge,X,(m,_)=>{var g=Le(),M={},W=o(g,!0);r(g),k(()=>{M!==(M=e(_).value)&&(g.value=(g.__value=e(_).value)==null?"":e(_).value),b(W,e(_).label)}),E(m,g)}),r(x);var N=s(x,2),P=o(N);r(N),r(h),r(q);var H=s(q,2),C=s(o(H),2);k(()=>{e(i),le(()=>{})}),U(C,5,()=>me,X,(m,_)=>{var g=Be(),M={},W=o(g,!0);r(g),k(()=>{M!==(M=e(_).value)&&(g.value=(g.__value=e(_).value)==null?"":e(_).value),b(W,e(_).label)}),E(m,g)}),r(C),r(H),r(c);var O=s(c,2),de=o(O),V=s(de,2),Te=o(V,!0);r(V),r(O),r(d),r(t),k(()=>{$e(P,1,`fas ${e(i).icon} text-${e(i).color}-500`),V.disabled=e(L),b(Te,e(L)?"Creating...":"Create Category")}),ce(f,()=>e(i).name,m=>Q(i,e(i).name=m)),ce(y,()=>e(i).description,m=>Q(i,e(i).description=m)),ue(x,()=>e(i).icon,m=>Q(i,e(i).icon=m)),ue(C,()=>e(i).color,m=>Q(i,e(i).color=m)),w("click",de,ee),w("submit",d,Se(_e)),E(a,t)};Y(ae,a=>{e(I)&&a(Ee)})}var K=s(ae,2),oe=s(o(K));U(oe,5,()=>e(u),X,(a,t)=>{var d=He(),c=o(d),v=o(c,!0);r(c);var f=s(c),F=o(f,!0);r(f);var y=s(f),q=o(y,!0);r(y);var h=s(y),x=o(h),N=s(x,2);r(h),r(d),k(()=>{b(v,e(t).id),b(F,e(t).name),b(q,e(t).description)}),w("click",x,()=>he(e(t).id)),w("click",N,()=>xe(e(t).id)),E(a,d)}),r(oe),r(K);var se=s(K,4),ie=s(o(se));U(ie,5,()=>e(p),X,(a,t)=>{var d=Qe(),c=o(d),v=o(c,!0);r(c);var f=s(c),F=o(f,!0);r(f);var y=s(f),q=o(y,!0);r(y);var h=s(y),x=o(h,!0);r(h);var N=s(h),P=o(N),H=s(P,2);r(N),r(d),k((C,O)=>{b(v,e(t).title),b(F,C),b(q,e(t).author.name),b(x,O)},[()=>{var C;return((C=e(u).find(O=>O.id===e(t).category))==null?void 0:C.name)||e(t).category},()=>new Date(e(t).createdAt).toLocaleDateString()],Ne),w("click",P,()=>fe(e(t).id)),w("click",H,()=>ye(e(t).id)),E(a,d)}),r(ie),r(se),r(B),w("click",Ce,()=>n(I,!0)),je(1,B,()=>Ae),E(G,B),Fe()}export{ct as component};
