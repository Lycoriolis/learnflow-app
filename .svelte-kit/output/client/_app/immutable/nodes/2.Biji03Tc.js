var L=(S,k,r)=>new Promise(($,a)=>{var i=t=>{try{f(r.next(t))}catch(s){a(s)}},w=t=>{try{f(r.throw(t))}catch(s){a(s)}},f=t=>t.done?$(t.value):Promise.resolve(t.value).then(i,w);f((r=r.apply(S,k)).next())});import"../chunks/COm6N4YE.js";import"../chunks/69_IOA4Y.js";import{p as ee,l as D,a as te,f as F,b as re,g as l,m as q,s as _,c as E,d as c,r as d,t as N,e as ae}from"../chunks/HPQed-Yx.js";import{s as G}from"../chunks/PqlH_gqs.js";import{i as I}from"../chunks/Da7F0fHf.js";import{c as oe,a as m,t as y}from"../chunks/ZM6Rlk1U.js";import{s as ie}from"../chunks/DvN1gL60.js";import{s as se}from"../chunks/G1Z7eEzt.js";import{t as H,f as K}from"../chunks/D3PCwpG5.js";import{i as ne}from"../chunks/D0cPXSkH.js";import{s as le,a as x}from"../chunks/CGqtlgv0.js";import{g as ce}from"../chunks/GvWXBGfm.js";import{p as de}from"../chunks/BBukhNps.js";import{u as fe,l as ue,i as ge,g as M,a as me}from"../chunks/BRK8y73W.js";import{o as ve,a as pe}from"../chunks/Bpt9IQqH.js";var he=y('<div class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex justify-center items-center"><div class="flex flex-col items-center"><div class="w-16 h-16 border-4 border-t-indigo-500 border-indigo-200 rounded-full animate-spin"></div> <p class="mt-4 text-gray-600 dark:text-gray-400">Verifying authentication...</p></div></div>'),be=y('<div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4" role="alert"><p class="font-bold">Warning</p> <p> </p></div>'),_e=y("<!> <!>",1),xe=y('<div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4" role="alert"><p> </p></div>'),ye=y('<div class="flex justify-center items-center min-h-screen bg-gray-100 dark:bg-gray-900"><div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg max-w-md w-full"><div class="text-center"><div class="mb-4 flex justify-center"><div class="h-16 w-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center"><i class="fas fa-lock text-red-600 dark:text-red-400 text-2xl"></i></div></div> <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Authentication Required</h2> <p class="text-gray-600 dark:text-gray-400 mb-6">You need to be logged in to access this page.</p> <!> <a class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded">Go to Login</a></div></div></div>');function ze(S,k){ee(k,!1);const[r,$]=le(),a=()=>x(ge,"$isAuthenticated",r),i=()=>x(ue,"$loading",r),w=()=>x(de,"$page",r),f=()=>x(fe,"$user",r),t=()=>x(me,"$authError",r);let s=q(!1),T=q(!1),u=q("");const O=5*60*1e3;let j=null;function P(){return L(this,null,function*(){try{!a()&&!i()&&((yield M())||(console.warn("User not authenticated, redirecting to login"),R()))}catch(e){console.error("Authentication check failed:",e),_(u,"Failed to verify authentication status")}finally{_(T,!0),_(s,!0)}})}function R(){ce("/login?redirect="+encodeURIComponent(w().url.pathname))}function W(){j=setInterval(()=>L(null,null,function*(){try{!(yield M())&&a()&&(console.warn("Session expired during active use, redirecting to login"),R())}catch(e){console.error("Session check failed:",e)}}),O)}ve(()=>{console.log("Protected layout mounted",{isAuthenticated:a(),loading:i(),user:f()?{email:f().email}:null}),P(),W()}),pe(()=>{j&&clearInterval(j)}),D(()=>(i(),l(s),a()),()=>{!i()&&!l(s)&&(_(s,!0),console.log("Auth check in protected layout:",{isAuthenticated:a(),loading:i()}),a()||(console.warn("User not authenticated, redirecting to login"),R()))}),D(()=>t(),()=>{t()&&_(u,t())}),te(),ne();var V=oe(),Y=F(V);{var B=e=>{var A=he();H(1,A,()=>K),m(e,A)},J=(e,A)=>{{var Q=g=>{var n=_e(),v=F(n);{var C=p=>{var h=be(),o=E(c(h),2),b=c(o,!0);d(o),d(h),N(()=>G(b,l(u))),m(p,h)};I(v,p=>{l(u)&&p(C)})}var U=E(v,2);ie(U,k,"default",{}),m(g,n)},X=g=>{var n=ye(),v=c(n),C=c(v),U=E(c(C),6);{var p=o=>{var b=xe(),z=c(b),Z=c(z,!0);d(z),d(b),N(()=>G(Z,l(u))),m(o,b)};I(U,o=>{l(u)&&o(p)})}var h=E(U,2);d(C),d(v),d(n),N(o=>se(h,"href",`/login?redirect=${o!=null?o:""}`),[()=>encodeURIComponent(w().url.pathname)],ae),H(1,n,()=>K),m(g,n)};I(e,g=>{a()?g(Q):g(X,!1)},A)}};I(Y,e=>{i()||!l(T)?e(B):e(J,!1)})}m(S,V),re(),$()}export{ze as component};
//# sourceMappingURL=2.Biji03Tc.js.map
